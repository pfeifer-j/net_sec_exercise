"""
exercise 3.2.1
@Authors: Noah Link, Jan Pfeifer, Julian Weske
"""

import socket

if __name__ == "__main__":
    HOST = "195.37.209.19"
    PORT = 7213

    # Create a socket object
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as client_socket:
        # Connect to the server
        client_socket.connect((HOST, PORT))
        print("\n##########################\n")
        print("Connection established with server.")

        """
        # Send data request to the server
        data_request_hex = "010a00013d07e50004770473840100012e"
        client_socket.sendall(bytes.fromhex(data_request_hex))
        print("Data request sent: ", bytes.fromhex(data_request_hex))
        response = client_socket.recv(4096)
        print("Data response from server:", response)
        print("\n##########################\n")
        """

        # Construct the file request packet
        # b'\x01\n\x00\x01=\x07\xe5\x00\x19w\x04s\x99\x01\x00\x16./.security-report.txt'
        """
            List which files are available
            02 0a00013d 07 e5 00 31 740473b1030001 002b2e73656375726974792d7265706f72742e7478740a6d61726b6574696e672d73747261746567792e7478740a

            Request for marketing.txt
            01 0a00013d 07 e5 00 19 770473990100 16 6d61726b6574696e672d73747261746567792e747874"
            
            - 01: Nachricht von Client (02 ist von Server)
            - 0a00013d: 10.0.1.61 ist eine IP Adresse
            - 

            - 16: l√§nge der payload in hex
            - 6d61726b6574696e672d73747261746567792e747874: payload (44 Zeichen, 22 Bit, 22 in Hex ist 16)


            Request for .security-report.txt
            01 0a 00 01 3d 07 e5 00 19 77047399010014 2e73656375726974792d7265706f72742e747874"
            
            Marketing response:
            020a 0001 3d07 e50a 6f 740473e5020016 0a546d61726b6574696e672d73747261746567792e74787453616c657320537472617465677920666f7220746865204e65772050726f647563740a0a50726f64756374204e616d653a20517569636b466974e284a2efb88f0a0a496e74726f64756374696f6e3a0a517569636b466974e284a2efb88f20697320616e20696e6e6f7661746976652070726f647563742064657369676e6564207370656369666963616c6c7920666f7220637573746f6d6572732077686f2076616c756520626f7468207175616c69747920616e64206166666f72646162696c6974792e204f75722070726f64756374206973206d616e75666163747572656420696e204368696e612c20616c6c6f77696e6720757320746f206c6576657261676520636f73742d6566666563746976652070726f64756374696f6e20616476616e746167657320746f206f6666657220686967682d7175616c69747920676f6f64732061742061206672616374696f6e206f662074686520757375616c20636f7374732e20546869732073747261746567792061696d7320746f20756e646572637574206f757220636f6d70657469746f7273207768696c65207365637572696e67206f7572206d61726b657420736861726520696e204575726f70652e0a0a5461726765742041756469656e63653a0a4f7572207072696d61727920666f637573206973206f6e2070726963652d636f6e7363696f757320636f6e73756d65727320696e204575726f70652077686f2076616c7565207175616c69747920616e642066756e6374696f6e616c6974792e205468697320696e636c7564657320686f757365686f6c64732077697468206d6f64657261746520696e636f6d65732061732077656c6c20617320736d616c6c20627573696e6573736573206c6f6f6b696e6720746f20726564756365207468656972206f7065726174696e6720636f7374732e0a0a53616c6573204368616e6e656c733a0a0a202020204f6e6c696e6520506c6174666f726d733a205574696c697a652065737461626c697368656420652d636f6d6d6572636520706c6174666f726d73207375636820617320416d617a6f6e2c20654261792c20616e642070726f707269657461727920776562736974657320746f2073656c6c207468652070726f64756374206469726563746c7920746f20656e6420636f6e73756d6572732e0a2020202052657461696c2053746f7265733a20466f72676520706172746e657273686970732077697468206c6f63616c2072657461696c65727320616e6420646973636f756e7465727320746f206f6666657220517569636b466974e284a2efb88f20696e20706879736963616c2073746f7265732e0a2020202057686f6c6573616c653a204f666665722061747472616374697665207465726d7320746f2077686f6c6573616c65727320746f20616368696576652062726f6164657220646973747269627574696f6e20616e642073656c6c207468652070726f6475637420696e206c6172676572207175616e7469746965732e0a0a4d61726b6574696e672053747261746567793a0a0a20202020456d70686173697a6520507269636520416476616e746167653a20486967686c696768742074686520636f737420656666696369656e6379206f66207468652070726f647563"
            01 0a 00 01 3d 07 e50004 770473840100012e"
        """
        file_request_hex = (
            # "01 0a00013d 07 e5 00 19 770473990100 16 6d61726b6574696e672d73747261746567792e747874"
            "01 0a00013d 07 e5 00 19 770473990100 13 73656375726974792d7265706f72742e747874000000"
            # "01 0a00013d 07 e5 00 19 770473990100 14 6d61726b6574696e672d73747261746567792e747874"
        ).replace(" ", "")
        client_socket.sendall(bytes.fromhex(file_request_hex))
        print("File request sent: ", bytes.fromhex(file_request_hex))
        response = client_socket.recv(4096)
        print("File response from server:", response)
        print("\n##########################\n")
